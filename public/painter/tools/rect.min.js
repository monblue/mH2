(function(e){e.fn.rectTool=function(){function c(){t.drawRect({fillStyle:color,x:u,y:a,width:s,height:o,fromCenter:!0})}var t=this;t.unbind();var n=t[0].getContext("2d"),r=!1,i=!1,s=0,o=0,u,a,f,l;t.on(getTouchEventName("mousedown"),function(e){hist.push(last.src=t[0].toDataURL("image/png"));u=e.offsetX;a=e.offsetY;c();r=!0;return!1});t.on(getTouchEventName("mouseup"),function(){r=!1;s=0;o=0;last.src=t[0].toDataURL("image/png")});e(document).keydown(function(e){e.keyCode===16&&(i=!0)});e(document).keyup(function(e){e.keyCode===16&&(i=!1)});t.on(getTouchEventName("mousemove"),function(e){r===!0&&t.clearCanvas().drawImage({source:last.src,x:0,y:0,fromCenter:!1,load:function(){f=e.offsetX+s/2;l=e.offsetY+o/2;s=f-u;o=l-a;i===!0&&(o=s);c()}})})}})(jQuery);