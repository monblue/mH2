(function(e){e(document).ready(function(){function s(e){window.ontouchstart!==undefined&&r[e]&&(e=r[e]);return e}function o(){$canvas.clearCanvas();$canvas.drawRect({fillStyle:"#fff",x:0,y:0,width:canvasW,height:canvasH,fromCenter:!1})}function u(){t.stroke.width(window.stroke);t.stroke.height(window.stroke);t.stroke.css({marginTop:(t.box.height()-t.stroke.height())/2});if(start===!1){t.stroke.css({backgroundColor:color});start+=1}else start===!0&&t.stroke.stop().animate({backgroundColor:color},n);start=!0}function f(){function i(t,n){a[t]&&a[t][n]&&e('<div class="color '+t+" "+n+'" />').css({backgroundColor:a[t][n]}).appendTo("#colors")}var t,n,r;t=["red","green","blue","orange","yellow","purple","brown","white","black"],r;for(r=0;r<t.length;r+=1){n=t[r];i(n,"light");i(n,"medium");i(n,"dark")}}function l(t){var n=t.split(" ");t=e("."+n[0]+"."+n[1]);t.addClass("chosen");color=t.css("backgroundColor");u()}function c(e){var n=t.slider.width(),r=t.slider.children("#filler");r.width(n*(e/100))}window.$canvas=e("#canvas");window.color="blue medium",window.press=!1,window.last=new Image,window.hist=[],window.clicks=0,window.start=!1;window.canvasW=$canvas.width();window.canvasH=$canvas.height();var t={};t.stroke=e("#stroke");t.strokeContainer=e("#stroke-container");t.box=e("#box");t.tools=e("#tools");t.clear=e("#clear");t.slider=e("#slider");t.colors=e("#colors");t.brush=e("#brush");t.path=e("#path");t.rect=e("#rect");t.ellipse=e("#ellipse");t.erase=e("#erase");t.undo=e("#undo");t.save=e("#save");var n,r={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},i={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"};window.getTouchEventName=s;var a={red:{dark:"#a11",medium:"#c33",light:"#e55"},green:{dark:"#4b1",medium:"#6d2",light:"#8f4"},blue:{dark:"#14b",medium:"#36d",light:"#58f"},orange:{dark:"#d51",medium:"#f73",light:"#f95"},yellow:{dark:"#ed2",medium:"#fe3",light:"#ff5"},purple:{dark:"#75d",medium:"#96f",light:"#b8f"},black:{dark:"#000",medium:"#666",light:"#ccc"}};t.tools.on("click",".tool",function(){t.tools.find(".chosen").removeClass("chosen");e(this).addClass("chosen")});t.clear.on("click",function(){$canvas.trigger("mouseup");last.src=$canvas[0].toDataURL("image/png");hist.push(last.src);o();clicks=0});t.save.on("click",function(){var e=$canvas[0].toDataURL("image/png");$canvas.mouseup();window.open(e)});t.undo.on("click",function(){var e=hist.length-1;$canvas.mouseup();clicks=0;if(e<0){e=0;return}last.src=hist[e];$canvas.clearCanvas();$canvas.drawImage({source:last.src,x:0,y:0,fromCenter:!1});hist.splice(hist.length-1,hist.length-1)});t.brush.on("click",function(){$canvas.brushTool();t.strokeContainer.slideDown(n)});t.path.on("click",function(){last.src=$canvas[0].toDataURL("image/png");$canvas.pathTool();t.strokeContainer.slideDown(n)});t.rect.on("click",function(){last.src=$canvas[0].toDataURL("image/png");$canvas.rectTool();t.strokeContainer.slideUp(n)});t.ellipse.on("click",function(){last.src=$canvas[0].toDataURL("image/png");$canvas.ellipseTool();t.strokeContainer.slideUp(n)});t.erase.on("click",function(){last.src=$canvas[0].toDataURL("image/png");$canvas.eraserTool();t.strokeContainer.slideDown(n)});t.brush.click();f();l(color);t.colors.on("click",".color",function(){var t=e(this);e(".color.chosen").removeClass("chosen");l(t.prop("class").replace(/(color|chosen) /gi,""));t.addClass("chosen")});t.slider.slider({min:1,value:50});startVal=t.slider.slider("option","value");c(startVal);stroke=Math.round(startVal/2);u();t.slider.bind("slide",function(e,t){var n=t.value;stroke=Math.round(n/2);u();c(n)});o()})})(jQuery);