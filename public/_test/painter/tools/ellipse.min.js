(function(e){e.fn.ellipseTool=function(){function l(){t.drawEllipse({fillStyle:color,x:i,y:s,width:a,height:f})}function c(){t.drawArc({fillStyle:color,x:i,y:s,radius:Math.abs(a)/2,fromCenter:!0})}var t=this;t.unbind();var n=!1,r=!1,i,s,o,u,a,f;t.on(getTouchEventName("mousedown"),function(e){hist.push(last.src=t[0].toDataURL("image/png"));n=!0;a=0;f=0;i=e.offsetX;s=e.offsetY;l();return!1});t.on(getTouchEventName("mouseup"),function(){n=!1;last.src=t[0].toDataURL("image/png")});e(document).keydown(function(e){e.keyCode===16&&(r=!0)});e(document).keyup(function(e){e.keyCode===16&&(r=!1)});t.on(getTouchEventName("mousemove"),function(e){n===!0&&t.clearCanvas().drawImage({source:last.src,x:0,y:0,fromCenter:!1,load:function(){o=e.offsetX+a/2;u=e.offsetY+f/2;a=o-i;f=u-s;r===!0?c():r===!1&&l()}})})}})(jQuery);