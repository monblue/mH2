(function(e){var t=!1,n="stroke",r="round",i=!0,s="image/png",o="offsetX",u="offsetY";e.fn.pathTool=function(){var a=this;a.unbind();clicks=0;var f=t,l=t,c=a.offset(),h=a[0].getContext("2d"),p=function(){a.drawLine({strokeWidth:window[n],strokeStyle:color,strokeCap:r,strokeJoin:r,x1:startX,y1:startY,x2:endX,y2:endY})};e(document).keydown(function(e){e.keyCode===16&&(l=i)});e(document).keyup(function(e){e.keyCode===16&&(l=t)});a.on(getTouchEventName("mousedown"),function(e){hist.push(last.src=a[0].toDataURL(s));l===i&&(clicks=0);if(clicks===0){startX=e[o];startY=e[u];a.drawArc({fillStyle:color,x:startX,y:startY,radius:window[n]/2,start:0,end:360});clicks++}else if(clicks===1){endX=e[o];endY=e[u];p();f=i;clicks++}else if(clicks>=1){startX=endX;startY=endY;endX=e[o];endY=e[u];p();f=i}return t});a.on(getTouchEventName("mouseup"),function(){clicks>=1&&(f=t);clicks>=1&&(last.src=a[0].toDataURL(s))});a.on(getTouchEventName("mousemove"),function(e){f===i&&a.clearCanvas().drawImage({source:last.src,x:0,y:0,fromCenter:t,load:function(){dragX=e[o];dragY=e[u];controlX=endX-(dragX-endX);controlY=endY-(dragY-endY);a.drawQuadratic({strokeWidth:window[n],strokeStyle:color,strokeCap:r,x1:startX,y1:startY,cx1:controlX,cy1:controlY,x2:endX,y2:endY})}})})}})(jQuery);